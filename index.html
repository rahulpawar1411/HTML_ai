<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>AI Voice Chat Agent</title>

<style>
:root {
  --bg-main: #0b1020;
  --bg-chat: #0f172a;
  --bg-user: #2563eb;
  --bg-bot: #1e293b;
  --border: #1e293b;
  --text-main: #e5e7eb;
  --text-muted: #9ca3af;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  height: 100vh;
  background: radial-gradient(circle at top, #111827, #020617);
  font-family: system-ui, sans-serif;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-main);
}

.chat-app {
  width: 100%;
  max-width: 420px;
  height: 100vh;
  max-height: 680px;
  background: var(--bg-chat);
  border-radius: 14px;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* Header */
.chat-header {
  padding: 14px 16px;
  border-bottom: 1px solid var(--border);
  display: flex;
  gap: 10px;
  align-items: center;
}

.dot {
  width: 10px;
  height: 10px;
  background: #22c55e;
  border-radius: 50%;
}

.chat-header h3 {
  margin: 0;
  font-size: 16px;
}

.chat-header span {
  font-size: 12px;
  color: var(--text-muted);
}

/* Chat */
.chat-box {
  flex: 1;
  padding: 16px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.message {
  max-width: 80%;
  padding: 10px 14px;
  border-radius: 12px;
  font-size: 14px;
}

.user {
  background: var(--bg-user);
  align-self: flex-end;
  border-bottom-right-radius: 4px;
}

.bot {
  background: var(--bg-bot);
  align-self: flex-start;
  border-bottom-left-radius: 4px;
}

/* Input */
.chat-input {
  padding: 12px;
  border-top: 1px solid var(--border);
  display: flex;
  gap: 8px;
}

.chat-input input {
  flex: 1;
  padding: 12px;
  background: #020617;
  border: 1px solid var(--border);
  border-radius: 10px;
  color: var(--text-main);
  outline: none;
}

.chat-input button {
  background: #2563eb;
  border: none;
  border-radius: 10px;
  color: #fff;
  padding: 0 14px;
  cursor: pointer;
  font-size: 14px;
}

.chat-input button:hover {
  background: #1d4ed8;
}

.mic {
  background: #020617;
  border: 1px solid var(--border);
}

@media (max-width: 480px) {
  .chat-app {
    height: 100vh;
    max-height: 100vh;
    border-radius: 0;
  }
}
</style>
</head>

<body>

<div class="chat-app">

  <div class="chat-header">
    <div class="dot"></div>
    <div>
      <h3>AI Voice Agent</h3>
      <span>Listening & Speaking</span>
    </div>
  </div>

  <div class="chat-box" id="chatBox"></div>

  <div class="chat-input">
    <button class="mic" onclick="startListening()">ðŸŽ¤</button>
    <input
      id="userInput"
      placeholder="Type or speak..."
      onkeydown="if(event.key==='Enter') sendMessage()"
    />
    <button onclick="sendMessage()">Send</button>
  </div>

</div>

<script>
/* ---------- SPEECH TO TEXT ---------- */
const SpeechRecognition =
  window.SpeechRecognition || window.webkitSpeechRecognition;

let recognition;
if (SpeechRecognition) {
  recognition = new SpeechRecognition();
  recognition.lang = "en-US";
  recognition.continuous = false;

  recognition.onresult = (event) => {
    document.getElementById("userInput").value =
      event.results[0][0].transcript;
  };
}

function startListening() {
  if (!recognition) {
    alert("Speech Recognition not supported");
    return;
  }
  recognition.start();
}

/* ---------- TEXT TO SPEECH ---------- */
function speak(text) {
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = "en-US";
  speechSynthesis.speak(utterance);
}

/* ---------- CHAT LOGIC ---------- */
async function sendMessage() {
  const input = document.getElementById("userInput");
  const msg = input.value.trim();
  if (!msg) return;

  addMessage(msg, "user");
  input.value = "";

  const thinking = addMessage("Thinking...", "bot");

  try {
    const formData = new FormData();
    formData.append("text", msg);

    const res = await fetch(
      "https://xyz007.app.n8n.cloud/webhook/ai-voice-chat",
      { method: "POST", body: formData }
    );

    const reply = await res.text();
    thinking.remove();
    addMessage(reply, "bot");
    speak(reply); // ðŸ”Š AI speaks

  } catch (e) {
    thinking.remove();
    addMessage("Error connecting to AI", "bot");
  }
}

function addMessage(text, type) {
  const chatBox = document.getElementById("chatBox");
  const div = document.createElement("div");
  div.className = `message ${type}`;
  div.innerText = text;
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
  return div;
}
</script>

</body>
</html>
